"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["799183"],{897054:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>d,metadata:()=>i,assets:()=>a,toc:()=>l,contentTitle:()=>o});var i=JSON.parse('{"id":"lakehouse/storages/hdfs","title":"HDFS","description":"This document describes the parameters required for accessing HDFS. These parameters apply to:","source":"@site/versioned_docs/version-2.1/lakehouse/storages/hdfs.md","sourceDirName":"lakehouse/storages","slug":"/lakehouse/storages/hdfs","permalink":"/docs/lakehouse/storages/hdfs","draft":false,"unlisted":false,"tags":[],"version":"2.1","frontMatter":{"title":"HDFS","language":"en"},"sidebar":"docs","previous":{"title":"File System","permalink":"/docs/lakehouse/metastores/filesystem"},"next":{"title":"S3","permalink":"/docs/lakehouse/storages/s3"}}'),t=n("785893"),r=n("250065");let d={title:"HDFS",language:"en"},o=void 0,a={},l=[{value:"Parameter Overview",id:"parameter-overview",level:2},{value:"Parameter Examples",id:"parameter-examples",level:3},{value:"IO Optimization",id:"io-optimization",level:2},{value:"Hedged Read",id:"hedged-read",level:3},{value:"dfs.client.socket-timeout",id:"dfsclientsocket-timeout",level:3},{value:"Debugging HDFS",id:"debugging-hdfs",level:2},{value:"HDFS Client",id:"hdfs-client",level:3}];function c(e){let s={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"This document describes the parameters required for accessing HDFS. These parameters apply to:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Catalog properties."}),"\n",(0,t.jsx)(s.li,{children:"Table Valued Function properties."}),"\n",(0,t.jsx)(s.li,{children:"Broker Load properties."}),"\n",(0,t.jsx)(s.li,{children:"Export properties."}),"\n",(0,t.jsx)(s.li,{children:"Outfile properties."}),"\n",(0,t.jsx)(s.li,{children:"Backup and Restore"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"parameter-overview",children:"Parameter Overview"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Property Name"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Default Value"}),(0,t.jsx)(s.th,{children:"Required"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.security.authentication"})}),(0,t.jsxs)(s.td,{children:["Authentication type for accessing HDFS. Supports ",(0,t.jsx)(s.code,{children:"kerberos"})," and ",(0,t.jsx)(s.code,{children:"simple"})]}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"simple"})}),(0,t.jsx)(s.td,{children:"No"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.kerberos.principal"})}),(0,t.jsxs)(s.td,{children:["Specify principal when authentication type is ",(0,t.jsx)(s.code,{children:"kerberos"})]}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"No"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.kerberos.keytab"})}),(0,t.jsxs)(s.td,{children:["Specify keytab when authentication type is ",(0,t.jsx)(s.code,{children:"kerberos"})]}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"No"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"hadoop.username"})}),(0,t.jsxs)(s.td,{children:["When authentication type is ",(0,t.jsx)(s.code,{children:"simple"}),", this user will be used to access HDFS. By default, the Linux system user running the Doris process will be used for access"]}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"-"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"dfs.nameservices"})}),(0,t.jsxs)(s.td,{children:["Manually configure parameters for HDFS high availability cluster. If using ",(0,t.jsx)(s.code,{children:"hadoop.config.resources"})," configuration, parameters will be automatically read from ",(0,t.jsx)(s.code,{children:"hdfs-site.xml"}),". Use with the following parameters:",(0,t.jsx)(s.br,{}),(0,t.jsx)(s.code,{children:"dfs.ha.namenodes.your-nameservice"}),(0,t.jsx)(s.br,{}),(0,t.jsx)(s.code,{children:"dfs.namenode.rpc-address.your-nameservice.nn1"}),(0,t.jsx)(s.br,{}),(0,t.jsx)(s.code,{children:"dfs.client.failover.proxy.provider"})," etc."]}),(0,t.jsx)(s.td,{children:"-"}),(0,t.jsx)(s.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"parameter-examples",children:"Parameter Examples"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'"hadoop.security.authentication" = "kerberos",\n"hadoop.kerberos.keytab" = "keytab",   \n"hadoop.kerberos.principal" = "principal"\n'})}),"\n",(0,t.jsx)(s.h2,{id:"io-optimization",children:"IO Optimization"}),"\n",(0,t.jsx)(s.h3,{id:"hedged-read",children:"Hedged Read"}),"\n",(0,t.jsx)(s.p,{children:"In some cases, high HDFS load may cause reading certain data replicas on HDFS to take a long time, which can slow down overall query efficiency. HDFS Client provides the Hedged Read feature.\nThis feature can start another read thread to read the same data when a read request exceeds a certain threshold without returning, and use whichever result returns first."}),"\n",(0,t.jsx)(s.p,{children:"Note: This feature may increase the load on the HDFS cluster, please use it judiciously."}),"\n",(0,t.jsx)(s.p,{children:"You can enable this feature in the following way:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"create catalog regression properties (\n    'type'='hms',\n    'hive.metastore.uris' = 'thrift://172.21.16.47:7004',\n    'dfs.client.hedged.read.threadpool.size' = '128',\n    'dfs.client.hedged.read.threshold.millis' = \"500\"\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"dfs.client.hedged.read.threadpool.size"})," represents the number of threads used for Hedged Read, which are shared by one HDFS Client. Typically, for one HDFS cluster, BE nodes will share one HDFS Client."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"dfs.client.hedged.read.threshold.millis"})," is the read threshold in milliseconds. When a read request exceeds this threshold without returning, it will trigger Hedged Read."]}),"\n",(0,t.jsx)(s.p,{children:"After enabling, you can see related parameters in the Query Profile:"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TotalHedgedRead"}),": Number of times Hedged Read was initiated."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"HedgedReadWins"}),": Number of successful Hedged Read attempts (initiated and returned faster than the original request)"]}),"\n",(0,t.jsx)(s.p,{children:"Note that the values here are cumulative for a single HDFS Client, not values for a single query. The same HDFS Client will be reused by multiple queries."}),"\n",(0,t.jsx)(s.h3,{id:"dfsclientsocket-timeout",children:"dfs.client.socket-timeout"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"dfs.client.socket-timeout"})," is a client configuration parameter in Hadoop HDFS, used to set the socket timeout when the client establishes connections or reads data from DataNode or NameNode, in milliseconds. The default value for this parameter is typically 60,000 milliseconds."]}),"\n",(0,t.jsxs)(s.p,{children:["Reducing the value of this parameter allows the client to timeout more quickly when encountering network delays, slow DataNode responses, or connection anomalies, and retry or switch to other nodes. This helps reduce waiting time and improve system response speed. For example, in some tests, setting ",(0,t.jsx)(s.code,{children:"dfs.client.socket-timeout"})," to a smaller value (such as 5000 milliseconds) can quickly detect DataNode delays or failures, thus avoiding long waits."]}),"\n",(0,t.jsx)(s.p,{children:"Notes:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Setting the timeout too small may cause frequent timeout errors during network fluctuations or high node load, affecting task stability."}),"\n",(0,t.jsx)(s.li,{children:"It is recommended to adjust this parameter value reasonably based on actual network environment and system load conditions to balance response speed and system stability."}),"\n",(0,t.jsxs)(s.li,{children:["This parameter should be set in the client configuration file (such as ",(0,t.jsx)(s.code,{children:"hdfs-site.xml"}),") to ensure the client uses the correct timeout when communicating with HDFS."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["In summary, properly configuring the ",(0,t.jsx)(s.code,{children:"dfs.client.socket-timeout"})," parameter can improve I/O response speed while ensuring system stability and reliability."]}),"\n",(0,t.jsx)(s.h2,{id:"debugging-hdfs",children:"Debugging HDFS"}),"\n",(0,t.jsx)(s.p,{children:"Hadoop environment configuration is complex, and in some cases, connectivity issues or poor access performance may occur. Here are some third-party tools to help users quickly troubleshoot connectivity issues and basic performance problems."}),"\n",(0,t.jsx)(s.h3,{id:"hdfs-client",children:"HDFS Client"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["Java: ",(0,t.jsx)(s.a,{href:"https://github.com/morningman/hdfs-client-java",children:"https://github.com/morningman/hdfs-client-java"})]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:["CPP: ",(0,t.jsx)(s.a,{href:"https://github.com/morningman/hdfs-client-cpp",children:"https://github.com/morningman/hdfs-client-cpp"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"These two tools can be used to quickly verify HDFS connectivity and read performance. Most of the Hadoop dependencies in these tools are the same as Doris's own Hadoop dependencies, so they can simulate Doris's access to HDFS scenarios to the greatest extent."}),"\n",(0,t.jsx)(s.p,{children:"The Java version accesses HDFS through Java, which can simulate the logic of Doris FE side accessing HDFS."}),"\n",(0,t.jsx)(s.p,{children:"The CPP version accesses HDFS through C++ calling libhdfs, which can simulate the logic of Doris BE side accessing HDFS."}),"\n",(0,t.jsx)(s.p,{children:"For specific usage instructions, please refer to the README of each respective code repository."})]})}function h(e={}){let{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},250065:function(e,s,n){n.d(s,{Z:function(){return o},a:function(){return d}});var i=n(667294);let t={},r=i.createContext(t);function d(e){let s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);
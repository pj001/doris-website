"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([["470113"],{563766:function(e,n,s){s.r(n),s.d(n,{default:()=>h,frontMatter:()=>l,metadata:()=>t,assets:()=>c,toc:()=>d,contentTitle:()=>r});var t=JSON.parse('{"id":"lakehouse/catalogs/iceberg-catalog","title":"Iceberg Catalog","description":"Doris supports accessing Iceberg table data through various metadata services. In addition to reading data, Doris also supports writing to Iceberg tables.","source":"@site/versioned_docs/version-3.0/lakehouse/catalogs/iceberg-catalog.md","sourceDirName":"lakehouse/catalogs","slug":"/lakehouse/catalogs/iceberg-catalog","permalink":"/docs/3.0/lakehouse/catalogs/iceberg-catalog","draft":false,"unlisted":false,"tags":[],"version":"3.0","frontMatter":{"title":"Iceberg Catalog","language":"en"},"sidebar":"docs","previous":{"title":"Hive Catalog","permalink":"/docs/3.0/lakehouse/catalogs/hive-catalog"},"next":{"title":"Hudi Catalog","permalink":"/docs/3.0/lakehouse/catalogs/hudi-catalog"}}'),i=s("785893"),a=s("250065");let l={title:"Iceberg Catalog",language:"en"},r=void 0,c={},d=[{value:"Applicable Scenarios",id:"applicable-scenarios",level:2},{value:"Configuring Catalog",id:"configuring-catalog",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Supported Iceberg Versions",id:"supported-iceberg-versions",level:3},{value:"Supported Iceberg Formats",id:"supported-iceberg-formats",level:3},{value:"Supported Metadata Services",id:"supported-metadata-services",level:3},{value:"Supported Storage Systems",id:"supported-storage-systems",level:3},{value:"Supported Data Formats",id:"supported-data-formats",level:3},{value:"Column Type Mapping",id:"column-type-mapping",level:2},{value:"Examples",id:"examples",level:2},{value:"Iceberg on Hive Metastore",id:"iceberg-on-hive-metastore",level:3},{value:"Iceberg on Hadoop",id:"iceberg-on-hadoop",level:3},{value:"Iceberg on S3",id:"iceberg-on-s3",level:3},{value:"Iceberg on Glue",id:"iceberg-on-glue",level:3},{value:"Iceberg on DLF",id:"iceberg-on-dlf",level:3},{value:"Iceberg on Rest",id:"iceberg-on-rest",level:3},{value:"Iceberg on Rest with MINIO",id:"iceberg-on-rest-with-minio",level:3},{value:"Iceberg on Google Dataproc Metastore",id:"iceberg-on-google-dataproc-metastore",level:3},{value:"Iceberg on S3 Tables",id:"iceberg-on-s3-tables",level:3},{value:"Query Operations",id:"query-operations",level:2},{value:"Basic Query",id:"basic-query",level:3},{value:"Time Travel",id:"time-travel",level:3},{value:"Branch and Tag",id:"branch-and-tag",level:3},{value:"System Tables",id:"system-tables",level:2},{value:"entries",id:"entries",level:3},{value:"files",id:"files",level:3},{value:"history",id:"history",level:3},{value:"manifests",id:"manifests",level:3},{value:"metadata_log_entries",id:"metadata_log_entries",level:3},{value:"partitions",id:"partitions",level:3},{value:"refs",id:"refs",level:3},{value:"snapshots",id:"snapshots",level:3},{value:"Write Operations",id:"write-operations",level:2},{value:"INSERT INTO",id:"insert-into",level:3},{value:"INSERT OVERWRITE",id:"insert-overwrite",level:3},{value:"CTAS",id:"ctas",level:3},{value:"Related Parameters",id:"related-parameters",level:3},{value:"Database and Table Management",id:"database-and-table-management",level:2},{value:"Creating and Dropping Databases",id:"creating-and-dropping-databases",level:3},{value:"Creating and Dropping Tables",id:"creating-and-dropping-tables",level:3},{value:"Schema Change",id:"schema-change",level:3},{value:"Iceberg Table Optimization",id:"iceberg-table-optimization",level:2},{value:"View Data File Distribution",id:"view-data-file-distribution",level:3},{value:"View Snapshot and Branch",id:"view-snapshot-and-branch",level:3}];function o(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Doris supports accessing Iceberg table data through various metadata services. In addition to reading data, Doris also supports writing to Iceberg tables."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/best-practices/doris-iceberg",children:"Quick start with Apache Doris and Apache Iceberg"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Users can access Iceberg tables using Hive Metastore as metadata through the Hive Catalog. However, it is still recommended to use the Iceberg Catalog directly to avoid some compatibility issues."})}),"\n",(0,i.jsx)(n.h2,{id:"applicable-scenarios",children:"Applicable Scenarios"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Scenario"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Query Acceleration"}),(0,i.jsx)(n.td,{children:"Use Doris's distributed computing engine to directly access Iceberg data for faster queries."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Data Integration"}),(0,i.jsx)(n.td,{children:"Read Iceberg data and write it to internal Doris tables, or perform ZeroETL operations using the Doris computing engine."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Data Write-back"}),(0,i.jsx)(n.td,{children:"Process data from any Doris-supported data source and write it back to Iceberg table storage."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuring-catalog",children:"Configuring Catalog"}),"\n",(0,i.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG [IF NOT EXISTS] catalog_name PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = '<iceberg_catalog_type>',\n    'warehouse' = '<warehouse>' --optional\n    {MetaStoreProperties},\n    {StorageProperties},\n    {CommonProperties}\n);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"<iceberg_catalog_type>"})}),"\n",(0,i.jsx)(n.p,{children:"The type of Iceberg Catalog, supporting the following options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hms"}),": Uses Hive Metastore as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rest"}),": Metadata service compatible with the Iceberg Rest Catalog interface."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hadoop"}),": Directly accesses metadata stored on the file system."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"glue"}),": Uses AWS Glue as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"dlf"}),": Uses Alibaba Cloud DLF as the metadata service."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"s3tables"}),": Uses AWS S3 Tables Catalog to visit ",(0,i.jsx)(n.a,{href:"https://aws.amazon.com/s3/features/tables/",children:"S3 Table Bucket"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"<warehouse>"})}),"\n",(0,i.jsxs)(n.p,{children:["The warehouse path for Iceberg. This parameter must be specified when ",(0,i.jsx)(n.code,{children:"<iceberg_catalog_type>"})," is ",(0,i.jsx)(n.code,{children:"hadoop"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"warehouse"})," path must point to the level above the ",(0,i.jsx)(n.code,{children:"Database"})," path. For example, if your table path is ",(0,i.jsx)(n.code,{children:"s3://bucket/path/to/db1/table1"}),", then the ",(0,i.jsx)(n.code,{children:"warehouse"})," should be ",(0,i.jsx)(n.code,{children:"s3://bucket/path/to/"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{MetaStoreProperties}"})}),"\n",(0,i.jsx)(n.p,{children:"The MetaStoreProperties section is for entering connection and authentication information for the Metastore metadata service. Refer to the section on [Supported Metadata Services]."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{StorageProperties}"})}),"\n",(0,i.jsx)(n.p,{children:"The StorageProperties section is for entering connection and authentication information related to the storage system. Refer to the section on [Supported Storage Systems]."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"{CommonProperties}"})}),"\n",(0,i.jsxs)(n.p,{children:["The CommonProperties section is for entering general properties. See the ",(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/catalog-overview",children:"Catalog Overview"})," for details on common properties."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-iceberg-versions",children:"Supported Iceberg Versions"}),"\n",(0,i.jsx)(n.p,{children:"The current Iceberg dependency is version 1.6.1, which is compatible with higher versions of Iceberg."}),"\n",(0,i.jsx)(n.h3,{id:"supported-iceberg-formats",children:"Supported Iceberg Formats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Supports Iceberg V1/V2 formats."}),"\n",(0,i.jsx)(n.li,{children:"Supports Position Delete and Equality Delete."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-metadata-services",children:"Supported Metadata Services"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/metastores/hive-metastore",children:"Hive Metastore"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/metastores/aws-glue",children:"AWS Glue"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/metastores/aliyun-dlf",children:"Aliyun DLF"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/metastores/iceberg-rest",children:"Iceberg Rest Catalog"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/metastores/filesystem",children:"FileSystem"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-storage-systems",children:"Supported Storage Systems"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/hdfs",children:"HDFS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/s3",children:"AWS S3"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/gcs",children:"Google Cloud Storage"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/aliyun-oss",children:"Aliyun OSS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/tencent-cos",children:"Tencent COS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/huawei-obs",children:"Huawei OBS"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/storages/minio",children:"MINIO"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"supported-data-formats",children:"Supported Data Formats"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/file-formats/parquet",children:"Parquet"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/file-formats/orc",children:"ORC"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"column-type-mapping",children:"Column Type Mapping"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Iceberg Type"}),(0,i.jsx)(n.th,{children:"Doris Type"}),(0,i.jsx)(n.th,{children:"Comment"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"int"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"long"}),(0,i.jsx)(n.td,{children:"bigint"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"float"}),(0,i.jsx)(n.td,{children:"float"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"double"}),(0,i.jsx)(n.td,{children:"double"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"decimal(P, S)"}),(0,i.jsx)(n.td,{children:"decimal(P, S)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"date"}),(0,i.jsx)(n.td,{children:"date"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamp (Timestamp without timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"}),(0,i.jsx)(n.td,{children:"Mapped to datetime with precision 6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"timestamptz (Timestamp with timezone)"}),(0,i.jsx)(n.td,{children:"datetime(6)"}),(0,i.jsx)(n.td,{children:"Mapped to datetime with precision 6"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"fixed(N)"}),(0,i.jsx)(n.td,{children:"char(N)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"binary"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"uuid"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"struct"}),(0,i.jsx)(n.td,{children:"struct (supported from version 2.1.3)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"map"}),(0,i.jsx)(n.td,{children:"map (supported from version 2.1.3)"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"list"}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"other"}),(0,i.jsx)(n.td,{children:"UNSUPPORTED"}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-hive-metastore",children:"Iceberg on Hive Metastore"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hms PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://hms-host:7004',\n    'hadoop.username' = 'hive',\n    'dfs.nameservices' = 'your-nameservice',\n    'dfs.ha.namenodes.your-nameservice' = 'nn1,nn2',\n    'dfs.namenode.rpc-address.your-nameservice.nn1' = '172.21.0.2:4007',\n    'dfs.namenode.rpc-address.your-nameservice.nn2' = '172.21.0.3:4007',\n    'dfs.client.failover.proxy.provider.your-nameservice' = 'org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-hadoop",children:"Iceberg on Hadoop"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_hadoop PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 'hdfs://namenode:8020/dir/key'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-s3",children:"Iceberg on S3"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hadoop',\n    'warehouse' = 's3://bucket/dir/key',\n    's3.endpoint' = 's3.us-east-1.amazonaws.com',\n    's3.access_key' = 'ak',\n    's3.secret_key' = 'sk'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-glue",children:"Iceberg on Glue"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Using access key and secret key\nCREATE CATALOG iceberg_glue PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'glue',\n    'glue.endpoint' = 'https://glue.us-east-1.amazonaws.com/',\n    'client.credentials-provider' = 'com.amazonaws.glue.catalog.credentials.ConfigAWSProvider',\n    'client.credentials-provider.glue.access_key' = 'ak',\n    'client.credentials-provider.glue.secret_key' = 'sk'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-dlf",children:"Iceberg on DLF"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_dlf PROPERTIES (\n   'type' = 'hms',\n   'hive.metastore.type' = 'dlf',\n   'dlf.proxy.mode' = 'DLF_ONLY',\n   'dlf.endpoint' = 'datalake-vpc.cn-beijing.aliyuncs.com',\n   'dlf.region' = 'cn-beijing',\n   'dlf.uid' = 'uid',\n   'dlf.catalog.id' = 'catalog_id',\n   'dlf.access_key' = 'ak',\n   'dlf.secret_key' = 'sk'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-rest",children:"Iceberg on Rest"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_rest PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://172.21.0.1:8181'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-rest-with-minio",children:"Iceberg on Rest with MINIO"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_minio PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'rest',\n    'uri' = 'http://172.21.0.1:8181',\n    's3.access_key' = 'ak',\n    's3.secret_key' = 'sk',\n    's3.endpoint' = 'http://10.0.0.1:9000',\n    's3.region' = 'us-east-1'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-google-dataproc-metastore",children:"Iceberg on Google Dataproc Metastore"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_gdm PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 'hms',\n    'hive.metastore.uris' = 'thrift://172.21.0.1:9083',\n    'gs.endpoint' = 'https://storage.googleapis.com',\n    'gs.region' = 'us-east-1',\n    'gs.access_key' = 'ak',\n    'gs.secret_key' = 'sk',\n    'use_path_style' = 'true'\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"iceberg-on-s3-tables",children:"Iceberg on S3 Tables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE CATALOG iceberg_s3 PROPERTIES (\n    'type' = 'iceberg',\n    'iceberg.catalog.type' = 's3tables',\n    'warehouse' = 'arn:aws:s3tables:us-east-1:169000000000:bucket/doris-s3-table-bucket',\n    's3.region' = 'us-east-1',\n    's3.endpoint' = 's3.us-east-1.amazonaws.com',\n    's3.access_key' = 'ak',\n    's3.secret_key' = 'sk'\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Please refer to ",(0,i.jsx)(n.a,{href:"/docs/3.0/lakehouse/best-practices/doris-aws-s3tables",children:"Integration with AWS S3 Tables"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"query-operations",children:"Query Operations"}),"\n",(0,i.jsx)(n.h3,{id:"basic-query",children:"Basic Query"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- 1. switch to catalog, use database and query\nSWITCH iceberg;\nUSE iceberg_db;\nSELECT * FROM iceberg_tbl LIMIT 10;\n\n-- 2. use iceberg database directly\nUSE iceberg.iceberg_db;\nSELECT * FROM iceberg_tbl LIMIT 10;\n\n-- 3. use full qualified name to query\nSELECT * FROM iceberg.iceberg_db.iceberg_tbl LIMIT 10;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"time-travel",children:"Time Travel"}),"\n",(0,i.jsx)(n.p,{children:"You can read a specific snapshot of an Iceberg table."}),"\n",(0,i.jsx)(n.p,{children:"By default, read requests will access the latest snapshot version."}),"\n",(0,i.jsxs)(n.p,{children:["You can query a specific snapshot of an Iceberg table using the ",(0,i.jsx)(n.code,{children:"iceberg_meta()"})," table function:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'SELECT * FROM iceberg_meta(\n    \'table\' = \'iceberg_ctl.iceberg_db.iceberg_tbl\',\n    \'query_type\' = \'snapshots\'\n)\\G\n\n*************************** 1. row ***************************\n committed_at: 2024-11-28 11:07:29\n  snapshot_id: 8903826400153112036\n    parent_id: -1\n    operation: append\nmanifest_list: oss://path/to/metadata/snap-8903826400153112036-1-3835e66d-9a18-4cb0-b9b0-9ec80527ad8d.avro\n      summary: {"added-data-files":"2","added-records":"3","added-files-size":"2742","changed-partition-count":"2","total-records":"3","total-files-size":"2742","total-data-files":"2","total-delete-files":"0","total-position-deletes":"0","total-equality-deletes":"0"}\n*************************** 2. row ***************************\n committed_at: 2024-11-28 11:10:11\n  snapshot_id: 6099853805930794326\n    parent_id: 8903826400153112036\n    operation: append\nmanifest_list: oss://path/to/metadata/snap-6099853805930794326-1-dd46a1bd-219b-4fb0-bb46-ac441d8b3105.avro\n      summary: {"added-data-files":"1","added-records":"1","added-files-size":"1367","changed-partition-count":"1","total-records":"4","total-files-size":"4109","total-data-files":"3","total-delete-files":"0","total-position-deletes":"0","total-equality-deletes":"0"}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"FOR TIME AS OF"})," and ",(0,i.jsx)(n.code,{children:"FOR VERSION AS OF"})," clauses to read historical data based on snapshot ID or the time the snapshot was created. Here are some examples:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Read data as of a specific timestamp\nSELECT * FROM iceberg_table FOR TIME AS OF '2023-01-01 00:00:00';\n\n-- Read data as of a specific snapshot ID\nSELECT * FROM iceberg_table FOR VERSION AS OF 123456789;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"branch-and-tag",children:"Branch and Tag"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"This feature is supported since version 3.1.0"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Reading specific branches and tags of Iceberg tables is supported."}),"\n",(0,i.jsx)(n.p,{children:"Multiple syntax forms are supported to be compatible with systems such as Spark/Trino."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'-- BRANCH\nSELECT * FROM iceberg_tbl@brand(branch1);\nSELECT * FROM iceberg_tbl@brand("name" = "branch1");\nSELECT * FROM iceberg_tbl FOR VERSION AS OF \'branch1\';\n\n-- TAG\nSELECT * FROM iceberg_tbl@tag(tag1);\nSELECT * FROM iceberg_tbl@tag("name" = "tag1");\nSELECT * FROM iceberg_tbl FOR VERSION AS OF \'tag1\';\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"FOR VERSION AS OF"})," syntax, Doris will automatically determine whether the parameter is a timestamp or a Branch/Tag name."]}),"\n",(0,i.jsx)(n.h2,{id:"system-tables",children:"System Tables"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"This feature is supported since version 3.1.0"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Doris supports querying Iceberg system tables to retrieve metadata information about tables. You can use system tables to view snapshot history, manifest files, data files, partitions, and other metadata."}),"\n",(0,i.jsxs)(n.p,{children:["To access metadata of an Iceberg table, append a ",(0,i.jsx)(n.code,{children:"$"})," symbol followed by the system table name to the table name:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$system_table_name;\n"})}),"\n",(0,i.jsx)(n.p,{children:"For example, to view the table's history, you can execute:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$history;\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Currently, the ",(0,i.jsx)(n.code,{children:"all_manifests"})," and ",(0,i.jsx)(n.code,{children:"position_deletes"})," system tables are not yet supported and are planned to be supported in future versions."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"entries",children:"entries"}),"\n",(0,i.jsx)(n.p,{children:"Shows all manifest entries for the current snapshot of the table:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"all_entries"})," and ",(0,i.jsx)(n.code,{children:"entries"})," are similar, with the difference that ",(0,i.jsx)(n.code,{children:"all_entries"})," contains entries from all snapshots, while ",(0,i.jsx)(n.code,{children:"entries"})," only contains entries from the current snapshot."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$entries;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| status | snapshot_id         | sequence_number | file_sequence_number | data_file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | readable_metrics                                                                                                                                                                                                                                                   |\n+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|      2 | 4890031351138056789 |               1 |                    1 | {"content":0, "file_path":"s3://.../iceberg_table/data/id=1/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00001.parquet", "file_format":"PARQUET", "spec_id":0, "partition":{"id":1}, "record_count":1, "file_size_in_bytes":625, "column_sizes":{1:36, 2:41}, "value_counts":{1:1, 2:1}, "null_value_counts":{1:0, 2:0}, "nan_value_counts":{}, "lower_bounds":{1:"   ", 2:"Alice"}, "upper_bounds":{1:"   ", 2:"Alice"}, "key_metadata":null, "split_offsets":[4], "equality_ids":null, "sort_order_id":0, "first_row_id":null, "referenced_data_file":null, "content_offset":null, "content_size_in_bytes":null} | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":1, "upper_bound":1}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Alice", "upper_bound":"Alice"}} |\n|      0 | 1851184769713369003 |               1 |                    1 | {"content":0, "file_path":"s3://.../iceberg_table/data/id=2/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00002.parquet", "file_format":"PARQUET", "spec_id":0, "partition":{"id":2}, "record_count":1, "file_size_in_bytes":611, "column_sizes":{1:36, 2:39}, "value_counts":{1:1, 2:1}, "null_value_counts":{1:0, 2:0}, "nan_value_counts":{}, "lower_bounds":{1:"   ", 2:"Bob"}, "upper_bounds":{1:"   ", 2:"Bob"}, "key_metadata":null, "split_offsets":[4], "equality_ids":null, "sort_order_id":0, "first_row_id":null, "referenced_data_file":null, "content_offset":null, "content_size_in_bytes":null}     | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":2, "upper_bound":2}, "name":{"column_size":39, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Bob", "upper_bound":"Bob"}}     |\n+--------+---------------------+-----------------+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h3,{id:"files",children:"files"}),"\n",(0,i.jsx)(n.p,{children:"Shows file list for the current snapshot of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$files;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| content | file_path                                                                                       | file_format | spec_id | partition | record_count | file_size_in_bytes | column_sizes | value_counts | null_value_counts | nan_value_counts | lower_bounds          | upper_bounds          | key_metadata | split_offsets | equality_ids | sort_order_id | first_row_id | referenced_data_file | content_offset | content_size_in_bytes | readable_metrics                                                                                                                                                                                                                                                   |\n+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|       0 | s3://.../iceberg_table/data/id=2/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00002.parquet  | PARQUET     |       0 | {"id":2}  |            1 |                611 | {1:36, 2:39} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Bob"}   | {1:"   ", 2:"Bob"}   | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":2, "upper_bound":2}, "name":{"column_size":39, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Bob", "upper_bound":"Bob"}}     |\n|       0 | s3://.../iceberg_table/data/id=4/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00004.parquet  | PARQUET     |       0 | {"id":4}  |            1 |                618 | {1:36, 2:40} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Dave"}  | {1:"   ", 2:"Dave"}  | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":4, "upper_bound":4}, "name":{"column_size":40, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Dave", "upper_bound":"Dave"}}   |\n|       0 | s3://.../iceberg_table/data/id=6/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00006.parquet  | PARQUET     |       0 | {"id":6}  |            1 |                625 | {1:36, 2:41} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Frank"} | {1:"   ", 2:"Frank"} | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":6, "upper_bound":6}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Frank", "upper_bound":"Frank"}} |\n|       0 | s3://.../iceberg_table/data/id=8/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00008.parquet  | PARQUET     |       0 | {"id":8}  |            1 |                625 | {1:36, 2:41} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Heidi"} | {1:"   ", 2:"Heidi"} | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":8, "upper_bound":8}, "name":{"column_size":41, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Heidi", "upper_bound":"Heidi"}} |\n|       0 | s3://.../iceberg_table/data/id=10/00000-16-79ef2fd7-9997-47eb-a91a-9f7af8201315-0-00010.parquet | PARQUET     |       0 | {"id":10} |            1 |                618 | {1:36, 2:40} | {1:1, 2:1}   | {1:0, 2:0}        | {}               | {1:"   ", 2:"Judy"}  | {1:"   ", 2:"Judy"}  | NULL         | [4]           | NULL         |             0 |         NULL | NULL                 |           NULL |                  NULL | {"id":{"column_size":36, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":10, "upper_bound":10}, "name":{"column_size":40, "value_count":1, "null_value_count":0, "nan_value_count":null, "lower_bound":"Judy", "upper_bound":"Judy"}} |\n+---------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+---------+-----------+--------------+--------------------+--------------+--------------+-------------------+------------------+-----------------------+-----------------------+--------------+---------------+--------------+---------------+--------------+----------------------+----------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Similar to the ",(0,i.jsx)(n.code,{children:"files"})," system table, you can also query specific file type information through the following system tables:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Query data files for the current snapshot\nSELECT * FROM iceberg_table$data_files;\n\n-- Query delete files for the current snapshot\nSELECT * FROM iceberg_table$delete_files;\n\n-- Query all files (including data and delete files) from all snapshots\nSELECT * FROM iceberg_table$all_files;\n\n-- Query data files from all snapshots\nSELECT * FROM iceberg_table$all_data_files;\n\n-- Query delete files from all snapshots\nSELECT * FROM iceberg_table$all_delete_files;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The result format of these tables is similar to the ",(0,i.jsx)(n.code,{children:"files"})," system table, but each focuses specifically on data files or delete files. System tables with the ",(0,i.jsx)(n.code,{children:"all_"})," prefix contain files from all snapshots, not just files from the current snapshot."]}),"\n",(0,i.jsxs)(n.p,{children:["Note: When specific types of files do not exist in the table (for example, querying ",(0,i.jsx)(n.code,{children:"delete_files"})," when there are no delete files in the table), the query result may be empty."]}),"\n",(0,i.jsx)(n.h3,{id:"history",children:"history"}),"\n",(0,i.jsx)(n.p,{children:"Shows all history of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$history;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+----------------------------+---------------------+---------------------+---------------------+\n| made_current_at            | snapshot_id         | parent_id           | is_current_ancestor |\n+----------------------------+---------------------+---------------------+---------------------+\n| 2025-06-12 22:29:16.357000 | 1851184769713369003 |                NULL |                   1 |\n| 2025-06-12 22:29:39.922000 | 4890031351138056789 | 1851184769713369003 |                   1 |\n+----------------------------+---------------------+---------------------+---------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"manifests",children:"manifests"}),"\n",(0,i.jsx)(n.p,{children:"Shows manifest file info of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$manifests;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n| content | path                                                                         | length | partition_spec_id | added_snapshot_id   | added_data_files_count | existing_data_files_count | deleted_data_files_count | added_delete_files_count | existing_delete_files_count | deleted_delete_files_count | partition_summaries                                                            |\n+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n|       0 | s3://.../iceberg_table/metadata/3194eb8b-5ea4-4cbe-95ba-073229458e7b-m0.avro |   7138 |                 0 | 4890031351138056789 |                      0 |                         5 |                        5 |                        0 |                           0 |                          0 | [{"contains_null":0, "contains_nan":0, "lower_bound":"1", "upper_bound":"10"}] |\n+---------+------------------------------------------------------------------------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+--------------------------+-----------------------------+----------------------------+--------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h3,{id:"metadata_log_entries",children:"metadata_log_entries"}),"\n",(0,i.jsx)(n.p,{children:"Shows meta logs of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$metadata_log_entries;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n| timestamp                  | file                                                                                     | latest_snapshot_id  | latest_schema_id | latest_sequence_number |\n+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n| 2025-06-12 22:29:06.948000 | s3://.../iceberg_table/metadata/00000-e373aa16-15f1-4e69-ae7d-5ed64199cf9a.metadata.json |                NULL |             NULL |                   NULL |\n| 2025-06-12 22:29:16.357000 | s3://.../iceberg_table/metadata/00001-bbc8e244-e41c-4958-92f4-63b8c3ee1196.metadata.json | 1851184769713369003 |                0 |                      1 |\n| 2025-06-12 22:29:39.922000 | s3://.../iceberg_table/metadata/00002-7dc00d6a-6269-4200-9d28-5f8c1c6b9f99.metadata.json | 4890031351138056789 |                0 |                      2 |\n+----------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+------------------+------------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"partitions",children:"partitions"}),"\n",(0,i.jsx)(n.p,{children:"Shows partitions of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$partitions;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n| partition | spec_id | record_count | file_count | total_data_file_size_in_bytes | position_delete_record_count | position_delete_file_count | equality_delete_record_count | equality_delete_file_count | last_updated_at            | last_updated_snapshot_id |\n+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n| {"id":8}  |       0 |            1 |          1 |                           625 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":6}  |       0 |            1 |          1 |                           625 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":10} |       0 |            1 |          1 |                           618 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":4}  |       0 |            1 |          1 |                           618 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n| {"id":2}  |       0 |            1 |          1 |                           611 |                            0 |                          0 |                            0 |                          0 | 2025-06-12 22:29:16.357000 |      1851184769713369003 |\n+-----------+---------+--------------+------------+-------------------------------+------------------------------+----------------------------+------------------------------+----------------------------+----------------------------+--------------------------+\n'})}),"\n",(0,i.jsx)(n.p,{children:"Note:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For non-partitioned tables, the ",(0,i.jsx)(n.code,{children:"partitions"})," table will not contain the ",(0,i.jsx)(n.code,{children:"partition"})," and ",(0,i.jsx)(n.code,{children:"spec_id"})," fields."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"partitions"})," table shows partitions that contain data files or delete files in the current snapshot. However, delete files are not applied, so in some cases, a partition may still be displayed even if all data rows in the partition have been marked as deleted by delete files."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"refs",children:"refs"}),"\n",(0,i.jsx)(n.p,{children:"Shows all known snapshot references (branches and tags) for the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$refs;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n| name | type   | snapshot_id         | max_reference_age_in_ms | min_snapshots_to_keep | max_snapshot_age_in_ms |\n+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n| main | BRANCH | 4890031351138056789 |                    NULL |                  NULL |                   NULL |\n+------+--------+---------------------+-------------------------+-----------------------+------------------------+\n"})}),"\n",(0,i.jsx)(n.h3,{id:"snapshots",children:"snapshots"}),"\n",(0,i.jsx)(n.p,{children:"Shows all snapshots of the table:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM iceberg_table$snapshots;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Result:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| committed_at               | snapshot_id         | parent_id           | operation | manifest_list                                                                                        | summary                                                                                                                                                                                                                                                                                                                      |\n+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| 2025-06-12 22:29:16.357000 | 1851184769713369003 |                NULL | append    | s3://.../iceberg_table/metadata/snap-1851184769713369003-1-82059f57-821a-4983-b083-002cc2cde313.avro | {"spark.app.id":"application_1738810850199_0472", "added-data-files":"10", "added-records":"10", "added-files-size":"6200", "changed-partition-count":"10", "total-records":"10", "total-files-size":"6200", "total-data-files":"10", "total-delete-files":"0", "total-position-deletes":"0", "total-equality-deletes":"0"}  |\n| 2025-06-12 22:29:39.922000 | 4890031351138056789 | 1851184769713369003 | overwrite | s3://.../iceberg_table/metadata/snap-4890031351138056789-1-3194eb8b-5ea4-4cbe-95ba-073229458e7b.avro | {"spark.app.id":"application_1738810850199_0472", "deleted-data-files":"5", "deleted-records":"5", "removed-files-size":"3103", "changed-partition-count":"5", "total-records":"5", "total-files-size":"3097", "total-data-files":"5", "total-delete-files":"0", "total-position-deletes":"0", "total-equality-deletes":"0"} |\n+----------------------------+---------------------+---------------------+-----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n'})}),"\n",(0,i.jsx)(n.h2,{id:"write-operations",children:"Write Operations"}),"\n",(0,i.jsx)(n.h3,{id:"insert-into",children:"INSERT INTO"}),"\n",(0,i.jsx)(n.p,{children:"The INSERT operation appends data to the target table."}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT INTO iceberg_tbl VALUES (val1, val2, val3, val4);\nINSERT INTO iceberg.iceberg_db.iceberg_tbl SELECT col1, col2 FROM internal.db1.tbl1;\n\nINSERT INTO iceberg_tbl(col1, col2) VALUES (val1, val2);\nINSERT INTO iceberg_tbl(col1, col2, partition_col1, partition_col2) VALUES (1, 2, 'beijing', '2023-12-12');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"insert-overwrite",children:"INSERT OVERWRITE"}),"\n",(0,i.jsx)(n.p,{children:"The INSERT OVERWRITE operation completely replaces the existing data in the table with new data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT OVERWRITE TABLE iceberg_tbl VALUES (val1, val2, val3, val4);\nINSERT OVERWRITE TABLE iceberg.iceberg_db.iceberg_tbl(col1, col2) SELECT col1, col2 FROM internal.db1.tbl1;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ctas",children:"CTAS"}),"\n",(0,i.jsxs)(n.p,{children:["You can create an Iceberg table and write data using the ",(0,i.jsx)(n.code,{children:"CTAS"})," (Create Table As Select) statement:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_ctas AS SELECT * FROM other_table;\n"})}),"\n",(0,i.jsx)(n.p,{children:"CTAS supports specifying file formats, partitioning, and other properties:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_ctas\nPARTITION BY LIST (pt1, pt2) ()\nAS SELECT col1, pt1, pt2 FROM part_ctas_src WHERE col1 > 0;\n\nCREATE TABLE iceberg.iceberg_db.iceberg_ctas (col1, col2, pt1)\nPARTITION BY LIST (pt1) ()\nPROPERTIES (\n    'write-format'='parquet',\n    'compression-codec'='zstd'\n)\nAS SELECT col1, pt1 AS col2, pt2 AS pt1 FROM test_ctas.part_ctas_src WHERE col1 > 0;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"related-parameters",children:"Related Parameters"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"BE (Backend)"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter Name"}),(0,i.jsx)(n.th,{children:"Default Value"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"iceberg_sink_max_file_size"})}),(0,i.jsx)(n.td,{children:"1GB"}),(0,i.jsx)(n.td,{children:"Maximum data file size. When the written data exceeds this size, the current file is closed and a new file is created to continue writing."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_max_partition_nums_per_writer"})}),(0,i.jsx)(n.td,{children:"128"}),(0,i.jsx)(n.td,{children:"Maximum number of partitions each instance can write to on a BE node."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_non_partition_write_scaling_data_processed_threshold"})}),(0,i.jsx)(n.td,{children:"25MB"}),(0,i.jsxs)(n.td,{children:["Data threshold for starting scaling-write in non-partitioned tables. A new writer (instance) is used for every additional ",(0,i.jsx)(n.code,{children:"table_sink_non_partition_write_scaling_data_processed_threshold"})," of data. This mechanism adjusts the number of writers based on data volume to enhance throughput while conserving resources and minimizing file numbers for smaller data volumes."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_data_processed_rebalance_threshold"})}),(0,i.jsx)(n.td,{children:"25MB"}),(0,i.jsxs)(n.td,{children:["Minimum data volume threshold to trigger rebalancing for partitioned tables. Rebalancing starts if ",(0,i.jsx)(n.code,{children:"current accumulated data volume"})," - ",(0,i.jsx)(n.code,{children:"data volume since last rebalancing"})," >= ",(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_data_processed_rebalance_threshold"}),". Lowering this threshold can improve balance if file size differences are significant, but may increase rebalancing costs and impact performance."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"table_sink_partition_write_min_partition_data_processed_rebalance_threshold"})}),(0,i.jsx)(n.td,{}),(0,i.jsxs)(n.td,{children:["Minimum partition data volume threshold to trigger rebalancing. Rebalancing starts if ",(0,i.jsx)(n.code,{children:"current partition data volume"})," >= ",(0,i.jsx)(n.code,{children:"threshold"})," * ",(0,i.jsx)(n.code,{children:"number of tasks already allocated to the partition"}),". Lowering this threshold can improve balance if file size differences are significant, but may increase rebalancing costs and impact performance."]})]})]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"database-and-table-management",children:"Database and Table Management"}),"\n",(0,i.jsx)(n.h3,{id:"creating-and-dropping-databases",children:"Creating and Dropping Databases"}),"\n",(0,i.jsxs)(n.p,{children:["You can switch to the desired catalog using the ",(0,i.jsx)(n.code,{children:"SWITCH"})," statement and execute the ",(0,i.jsx)(n.code,{children:"CREATE DATABASE"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SWITCH iceberg;\nCREATE DATABASE [IF NOT EXISTS] iceberg_db;\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also create a database using a fully qualified name or specify a location (currently, only HMS-type catalogs support specifying a location), such as:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE [IF NOT EXISTS] iceberg.iceberg_db;\n\nCREATE DATABASE [IF NOT EXISTS] iceberg.iceberg_db\nPROPERTIES ('location'='hdfs://172.21.16.47:4007/path/to/db/');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can view the database's location information using the ",(0,i.jsx)(n.code,{children:"SHOW CREATE DATABASE"})," command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"mysql> SHOW CREATE DATABASE iceberg_db;\n+-------------+-------------------------------------------------------------------------------------------------+\n| Database    | Create Database                                                                                 |\n+-------------+-------------------------------------------------------------------------------------------------+\n| iceberg_db  | CREATE DATABASE iceberg_db LOCATION 'hdfs://172.21.16.47:4007/usr/hive/warehouse/iceberg_db.db' |\n+-------------+-------------------------------------------------------------------------------------------------+\n"})}),"\n",(0,i.jsx)(n.p,{children:"To drop a database:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"DROP DATABASE [IF EXISTS] iceberg.iceberg_db;\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsx)(n.p,{children:"For an Iceberg Database, you must first drop all tables under the database before you can drop the database itself; otherwise, an error will occur."})}),"\n",(0,i.jsx)(n.h3,{id:"creating-and-dropping-tables",children:"Creating and Dropping Tables"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Creating Tables"})}),"\n",(0,i.jsx)(n.p,{children:"Doris supports creating both partitioned and non-partitioned tables in Iceberg."}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Create unpartitioned iceberg table\nCREATE TABLE unpartitioned_table (\n  `col1` BOOLEAN COMMENT 'col1',\n  `col2` INT COMMENT 'col2',\n  `col3` BIGINT COMMENT 'col3',\n  `col4` FLOAT COMMENT 'col4',\n  `col5` DOUBLE COMMENT 'col5',\n  `col6` DECIMAL(9,4) COMMENT 'col6',\n  `col7` STRING COMMENT 'col7',\n  `col8` DATE COMMENT 'col8',\n  `col9` DATETIME COMMENT 'col9'\n)\nPROPERTIES (\n  'write-format'='parquet'\n);\n\n-- Create partitioned iceberg table\n-- The partition columns must be in table's column definition list\nCREATE TABLE partition_table (\n  `ts` DATETIME COMMENT 'ts',\n  `col1` BOOLEAN COMMENT 'col1',\n  `col2` INT COMMENT 'col2',\n  `col3` BIGINT COMMENT 'col3',\n  `col4` FLOAT COMMENT 'col4',\n  `col5` DOUBLE COMMENT 'col5',\n  `col6` DECIMAL(9,4) COMMENT 'col6',\n  `col7` STRING COMMENT 'col7',\n  `col8` DATE COMMENT 'col8',\n  `col9` DATETIME COMMENT 'col9',\n  `pt1` STRING COMMENT 'pt1',\n  `pt2` STRING COMMENT 'pt2'\n)\nPARTITION BY LIST (day(ts), pt1, pt2) ()\nPROPERTIES (\n  'write-format'='orc',\n  'compression-codec'='zlib'\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After creation, you can use the ",(0,i.jsx)(n.code,{children:"SHOW CREATE TABLE"})," command to view the Iceberg table creation statement. For details about partition functions, see the ",(0,i.jsx)(n.a,{href:"#",children:"Partitioning"})," section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Dropping Tables"})}),"\n",(0,i.jsxs)(n.p,{children:["You can drop an Iceberg table using the ",(0,i.jsx)(n.code,{children:"DROP TABLE"})," statement. Dropping a table will also remove its data, including partition data."]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"DROP TABLE [IF EXISTS] iceberg_tbl;\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Column Type Mapping"})}),"\n",(0,i.jsxs)(n.p,{children:["Refer to the ",(0,i.jsx)(n.a,{href:"#",children:"Column Type Mapping"})," section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Partitioning"})}),"\n",(0,i.jsx)(n.p,{children:"Partition types in Iceberg correspond to List partitions in Doris. Therefore, when creating an Iceberg partitioned table in Doris, you should use the List partitioning syntax, but you don't need to explicitly enumerate each partition. Doris will automatically create the corresponding Iceberg partitions based on the data values during data insertion."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Supports creating single-column or multi-column partitioned tables."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Supports partition transformation functions to enable Iceberg implicit partitioning and partition evolution. For specific Iceberg partition transformation functions, see ",(0,i.jsx)(n.a,{href:"https://iceberg.apache.org/spec/#partition-transforms",children:"Iceberg partition transforms"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"year(ts)"})," or ",(0,i.jsx)(n.code,{children:"years(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"month(ts)"})," or ",(0,i.jsx)(n.code,{children:"months(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"day(ts)"})," or ",(0,i.jsx)(n.code,{children:"days(ts)"})," or ",(0,i.jsx)(n.code,{children:"date(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"hour(ts)"})," or ",(0,i.jsx)(n.code,{children:"hours(ts)"})," or ",(0,i.jsx)(n.code,{children:"date_hour(ts)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"bucket(N, col)"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"truncate(L, col)"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"File Formats"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Parquet (default)"}),"\n",(0,i.jsxs)(n.p,{children:["Note that for the Iceberg table created by Doris, the Datetime corresponds to the ",(0,i.jsx)(n.code,{children:"timestamp_ntz"})," type."]}),"\n",(0,i.jsx)(n.p,{children:"In versions after 2.1.11 and 3.0.7, when the Datetime type is written to the Parquet file, the physical type used is INT64 instead of INT96."}),"\n",(0,i.jsxs)(n.p,{children:["And if the Iceberg table is created by other systems, although the ",(0,i.jsx)(n.code,{children:"timestamp"})," and ",(0,i.jsx)(n.code,{children:"timestamp_ntz"})," types are both mapped to the Doris Datetime type. However, when writing, it will determine whether the time zone needs to be processed based on the actual type."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ORC"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Compression Formats"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Parquet: snappy, zstd (default), plain (no compression)."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"ORC: snappy, zlib (default), zstd, plain (no compression)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Storage Medium"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"HDFS"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Object storage"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"schema-change",children:"Schema Change"}),"\n",(0,i.jsxs)(n.p,{children:["Start from 3.1.0, Doris supports schema changes for Iceberg tables, which can be modified using the ",(0,i.jsx)(n.code,{children:"ALTER TABLE"})," statement."]}),"\n",(0,i.jsx)(n.p,{children:"Supported schema change operations include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Rename Column"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"RENAME COLUMN"})," clause to rename columns. Renaming columns within nested types is not supported."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table RENAME COLUMN old_col_name TO new_col_name;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Add a Column"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"ADD COLUMN"})," to add a new column. The new column will be added to the end of the table. Adding new columns to nested types is not supported."]}),"\n",(0,i.jsx)(n.p,{children:"When adding a new column, you can specify nullable attributes, default values, and comments."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN col_name col_type [nullable, [default default_value, [comment 'comment']]];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN new_col STRING NOT NULL DEFAULT 'default_value' COMMENT 'This is a new col';\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Add Columns"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can also use ",(0,i.jsx)(n.code,{children:"ADD COLUMN"})," to add multiple columns. The new columns will be added to the end of the table. Adding new columns to nested types is not supported."]}),"\n",(0,i.jsx)(n.p,{children:"The syntax for each column is the same as adding a single column."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ADD COLUMN (col_name1 col_type1 [nullable, [default default_value, [comment 'comment']]], col_name2 col_type2 [nullable, [default default_value, [comment 'comment']]] ...);\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Drop Column"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"DROP COLUMN"})," to drop columns. Dropping columns within nested types is not supported."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table DROP COLUMN col_name;\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Modify Column"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"MODIFY COLUMN"})," statement to modify column attributes, including type, nullable, default value, and comment."]}),"\n",(0,i.jsx)(n.p,{children:"Note: When modifying column attributes, all attributes that are not being modified should also be explicitly specified with their original values."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table MODIFY COLUMN col_name col_type [nullable, [default default_value, [comment 'comment']]];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE iceberg_table (\n    id INT,\n    name STRING\n);\n-- Modify the id column type to BIGINT, set as NOT NULL, default value to 0, and add comment\nALTER TABLE iceberg_table MODIFY COLUMN id BIGINT NOT NULL DEFAULT 0 COMMENT 'This is a modified id column';\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Reorder Columns"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"ORDER BY"})," to reorder columns by specifying the new column order."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE iceberg_table ORDER BY (col_name1, col_name2, ...);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"iceberg-table-optimization",children:"Iceberg Table Optimization"}),"\n",(0,i.jsx)(n.h3,{id:"view-data-file-distribution",children:"View Data File Distribution"}),"\n",(0,i.jsx)(n.p,{children:"You can use the following SQL to analyze the data distribution and delete file count of Iceberg tables, helping determine whether optimization like Compaction is needed."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Display data file size distribution. This can help identify if there are too many"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT\n  CASE\n    WHEN file_size_in_bytes BETWEEN 0 AND 8 * 1024 * 1024 THEN '0-8M'\n    WHEN file_size_in_bytes BETWEEN 8 * 1024 * 1024 + 1 AND 32 * 1024 * 1024 THEN '8-32M'\n    WHEN file_size_in_bytes BETWEEN 2 * 1024 * 1024 + 1 AND 128 * 1024 * 1024 THEN '32-128M'\n    WHEN file_size_in_bytes BETWEEN 128 * 1024 * 1024 + 1 AND 512 * 1024 * 1024 THEN '128-512M'\n    WHEN file_size_in_bytes > 512 * 1024 * 1024 THEN '> 512M'\n    ELSE 'Unknown'\n  END AS SizeRange,\n  COUNT(*) AS FileNum\nFROM store_sales$data_files\nGROUP BY\n  SizeRange;\n\n+-----------+---------+\n| SizeRange | FileNum |\n+-----------+---------+\n| 0-8M      |       8 |\n| 8-32M     |       6 |\n+-----------+---------+\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Display the number of data files and delete files"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT\n  CASE\n    WHEN content = 0 THEN 'DataFile'\n    WHEN content = 1 THEN 'PositionDeleteFile'\n    WHEN content = 2 THEN 'EqualityDeleteFile'\n    ELSE 'Unknown'\n  END AS ContentType,\n  COUNT(*) AS FileNum,\n  SUM(file_size_in_bytes) AS SizeInBytes,\n  SUM(record_count) AS Records\nFROM\n  iceberg_table$files\nGROUP BY\n  ContentType;\n\n+--------------------+---------+-------------+---------+\n| ContentType        | FileNum | SizeInBytes | Records |\n+--------------------+---------+-------------+---------+\n| EqualityDeleteFile |    2787 |     1432518 |   27870 |\n| DataFile           |    2787 |     4062416 |   38760 |\n| PositionDeleteFile |      11 |       36608 |   10890 |\n+--------------------+---------+-------------+---------+\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"view-snapshot-and-branch",children:"View Snapshot and Branch"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'SELECT\n  refs_data.snapshot_id,\n  snapshots.committed_at,\n  snapshots.operation,\n  ARRAY_SORT(refs_data.refs)\nFROM (\n  SELECT\n    snapshot_id,\n    ARRAY_AGG(CONCAT(type, \':\', name)) AS refs\n  FROM\n    iceberg_table$refs\n  GROUP BY\n    snapshot_id\n) AS refs_data\nJOIN (\n  SELECT\n    snapshot_id,\n    committed_at,\n    operation\n  FROM\n    iceberg_table$snapshots\n) AS snapshots\nON refs_data.snapshot_id = snapshots.snapshot_id\nORDER BY\n  snapshots.committed_at;\n\n+---------------------+----------------------------+-----------+-------------------------------------+\n| snapshot_id         | committed_at               | operation | ARRAY_SORT(refs_data.refs)          |\n+---------------------+----------------------------+-----------+-------------------------------------+\n| 8272911997874079853 | 2025-07-10 15:27:07.177000 | append    | ["BRANCH:b1", "TAG:t1"]             |\n| 1325777059626757917 | 2025-07-10 15:27:07.530000 | append    | ["BRANCH:b2", "TAG:t2"]             |\n|   76492482642020578 | 2025-07-10 15:27:07.865000 | append    | ["BRANCH:b3", "TAG:t3"]             |\n| 1788715857849070138 | 2025-07-12 04:15:19.626000 | append    | ["BRANCH:main", "TAG:t4", "TAG:t5"] |\n+---------------------+----------------------------+-----------+-------------------------------------+\n'})})]})}function h(e={}){let{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},250065:function(e,n,s){s.d(n,{Z:function(){return r},a:function(){return l}});var t=s(667294);let i={},a=t.createContext(i);function l(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);